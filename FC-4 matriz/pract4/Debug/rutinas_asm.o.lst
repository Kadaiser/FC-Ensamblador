   1              	# 1 "../rutinas_asm.asm"
   1              	/*-----------------------------------------------------------------
   0              	
   0              	
   0              	
   2              	**
   3              	**  Fichero:
   4              	**    rutinas_asm.asm  10/6/2014
   5              	**
   6              	**    Fundamentos de Computadores
   7              	**    Dpto. de Arquitectura de Computadores y Automática
   8              	**    Facultad de Informática. Universidad Complutense de Madrid
   9              	**
  10              	**
  11              	**
  12              	**  Notas de diseño:
  13              	**
  14              	**---------------------------------------------------------------*/
  15              	
  16              	.global contarUnos
  17              	
  18              	
  19              	.text
  20              	/*	PROCEDIMIENTO QUE RECIBE 4 PARAMETROS
  21              	R0	DIRECCION DEL PRIMER ELEMENTO DE LA MATRIZ
  22              	R1	DIRECCION DEL VECTOR (nª de filas de la matriz = longitud del vector | elementos obntenidos en p
  23              	R2	VALOR DEL NUMERO DE FILAS DE LA MATRIZ
  24              	R3	VALOR DEL NUMERO DE COLUMNAS DE LA MATRIZ
  25              	*/
  26              	
  27              	contarUnos:
  28 0000 F0012DE9 	  		PUSH {R4,R5,R6,R7,R8}	//prologo, subrutina hoja, 2 variabes locales "i" "j", no retorna resulta
  29 0004 0040A0E3 	 		MOV R4, #0				//inicializar "i"
  30 0008 0050A0E3 	 		MOV R5, #0				//auxiliar de intercambio a 0 | auxiliar de nº de 1 en fila
  31 000c 0060A0E3 	 		MOV R6, #0				//INICIALIZAR "j"
  32              	 bucleI:
  33 0010 020054E1 	 		CMP R4, R2 				//for (i=0;i<nfilas;i++)
  34 0014 0E0000AA 			BGE finbucleI
  35 0018 045181E7 	 		STR	R5, [R1,R4,LSL#2] 	// vector[i]=0
  36              	
  37              	 bucleJ:
  38 001c 030056E1 	 		CMP R6, R3
  39 0020 080000AA 	 		BGE finbucleJ			//for (j=0; j<ncols; j++)
  40 0024 940207E0 			MUL R7, R4, R2			//R7 = i * nfilas
  41 0028 067087E0 			ADD R7, R7, R6			//R7 = i * nfilas+ j  (posicion del elemento en la matriz tomada unidimensionalm
  42 002c 078190E7 			LDR R8, [R0,R7,LSL#2]	//R8 = mat[i][j]
  43 0030 010058E3 			CMP R8, #1				// if(mat[i][j] == 1)
  44 0034 0100001A 			BNE not1
  45 0038 015085E2 			ADD R5, R5, #1			//incremento del numero de 1 encontrados
  46 003c 045181E7 			STR R5, [R1,R4,LSL#2]	//vector[i]++
  47              	not1:
  48 0040 016086E2 			ADD R6, R6, #1			//incrementar contador j
  49 0044 F4FFFFEA 			B bucleJ
  50              	
  51              	finbucleJ:
  52 0048 0060A0E3 			MOV R6, #0 				//reinicar contador "j"
  53 004c 014084E2 	 		ADD R4, R4, #1			//icrementar contador "i"
  54 0050 EEFFFFEA 	 		B bucleI
  55              	
  56              	finbucleI:
  57 0054 F001BDE8 			POP {R4,R5,R6,R7,R8}	//epílogo
  58 0058 1EFF2FE1 	  		bx lr
DEFINED SYMBOLS
  ../rutinas_asm.asm:27     .text:00000000 contarUnos
  ../rutinas_asm.asm:28     .text:00000000 $a
  ../rutinas_asm.asm:32     .text:00000010 bucleI
  ../rutinas_asm.asm:56     .text:00000054 finbucleI
  ../rutinas_asm.asm:37     .text:0000001c bucleJ
  ../rutinas_asm.asm:51     .text:00000048 finbucleJ
  ../rutinas_asm.asm:47     .text:00000040 not1
                   .debug_aranges:0000000c $d

NO UNDEFINED SYMBOLS
